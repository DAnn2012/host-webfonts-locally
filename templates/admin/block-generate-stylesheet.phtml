<?php
/* * * * * * * * * * * * * * * * * * * * *
 *
 *  ██████╗ ███╗   ███╗ ██████╗ ███████╗
 * ██╔═══██╗████╗ ████║██╔════╝ ██╔════╝
 * ██║   ██║██╔████╔██║██║  ███╗█████╗
 * ██║   ██║██║╚██╔╝██║██║   ██║██╔══╝
 * ╚██████╔╝██║ ╚═╝ ██║╚██████╔╝██║
 *  ╚═════╝ ╚═╝     ╚═╝ ╚═════╝ ╚═╝
 *
 * @package  : OMGF
 * @author   : Daan van den Bergh
 * @copyright: (c) 2020 Daan van den Bergh
 * @url      : https://daan.dev
 * * * * * * * * * * * * * * * * * * * */

defined('ABSPATH') || exit;

$db = new OMGF_DB();
$utmTags = '?utm_source=omgf&utm_medium=plugin&utm_campaign=settings';
?>
<div class="omgf-generate-stylesheet">
    <h3><?php _e('Generate Stylesheet', 'host-webfonts-local'); ?></h3>

    <div class="omgf-search-section">
        <div class="omgf-search-box">
            <input type="text" id="omgf-search" class="form-input-tip ui-autocomplete-input" placeholder="<?php _e('Search... (e.g. Roboto,Open Sans)', 'host-webfonts-local'); ?>" />
            <input type="button" id="omgf-search-subsets" class="button button-primary button-hero" value="<?php _e('Search', 'host-webfonts-local'); ?>"/>
            <input type="button" id="omgf-auto-detect" class="button button-secondary button-hero" value="<?= __('Auto-detect', 'host-webfonts-local'); ?>" />
        </div>
        <table>
            <tr id="row" valign="top">
                <th align="left" colspan="3"><?php _e('Available subsets', 'host-webfonts-local'); ?></th>
            </tr>
            <tbody id="omgf-subsets">
            <?php
            $subsetFonts = $db->get_subsets();
            ?>
            <?php if ($subsetFonts): ?>
                <?php foreach ($subsetFonts as $subsetFont): ?>
                    <tr valign="top" id="<?= $subsetFont['subset_font']; ?>">
                        <td>
                            <label>
                                <input readonly type="text" class="omgf-subset-font-family" data-font-family="<?= $subsetFont['subset_font']; ?>" value="<?= $subsetFont['subset_family']; ?>" />
                            </label>
                        </td>
                        <?php foreach ($subsetFont['available_subsets'] as $availableSubset): ?>
                            <td>
                                <label>
                                    <?php $checked = in_array($availableSubset, $subsetFont['selected_subsets']) ? 'checked="checked"' : ''; ?>
                                    <input class="omgf-subset" data-subset-font-family="<?= $subsetFont['subset_font']; ?>" value="<?= $availableSubset; ?>" type="checkbox" <?= $checked; ?> />
                                    <?= $availableSubset; ?>
                                </label>
                            </td>
                        <?php endforeach; ?>
                    </tr>
                <?php endforeach; ?>
            <?php else: ?>
                <tr colspan="3">
                    <td>
                        <em><?php _e('No subsets found. Use <strong>Search</strong> or <strong>Auto Detect</strong> start.', 'host-webfonts-local'); ?></em>
                    </td>
                </tr>
            <?php endif; ?>
            </tbody>
        </table>
        <table>
            <tr valign="top">
                <th align="left" colspan="3"><?php _e('Available fonts', 'host-webfonts-local'); ?></th>
            </tr>
        </table>
        <table id="omgf-font-styles-list">
            <?php
            $savedFonts = $db->get_total_fonts();
            ?>
            <?php if ($savedFonts && $subsetFonts): ?>
                <thead align="center">
                <th>
                    <?= __('Font Family', 'host-webfonts-local'); ?>
                </th>
                <th>
                    <?= __('Font Style', 'host-webfonts-local'); ?>
                </th>
                <th>
                    <?= __('Font Weight', 'host-webfonts-local'); ?>
                </th>
                <th>
                    <?= __('Preload? *', 'host-webfonts-local'); ?>
                </th>
                <th></th>
                </thead>
                <tbody id="omgf-font-styles">
                <?php foreach ($savedFonts as $font):
                    $fontId = $font['font_id'];
                    ?>
                    <tr class="omgf-font-style" data-font-id="<?= $fontId; ?>" id="row-<?= $fontId; ?>">
                        <td style="width: 195px;">
                            <input readonly type="text" value="<?= $font['font_family']; ?>" />
                        </td>
                        <td style="width: 150px;">
                            <input style="width: 150px;" readonly type="text" value="<?= $font['font_style']; ?>" />
                        </td>
                        <td style="width: 100px;">
                            <input style="width: 100px;" readonly type="text" value="<?= $font['font_weight']; ?>" />
                        </td>
                        <td align="center" style="width: 75px;">
                            <input type="checkbox" class="omgf-font-preload" data-preload="<?= $fontId; ?>" value="1" <?= $font['preload'] == 1 ? 'checked' : ''; ?> />
                        </td>
                        <td>
                            <input type="hidden" value="<?= $fontId; ?>" />
                            <input type="hidden" value="<?= $font['local']; ?>" />
                            <input type="hidden" value="<?= $font['url_ttf']; ?>" />
                            <input type="hidden" value="<?= $font['url_woff']; ?>" />
                            <input type="hidden" value="<?= $font['url_woff2']; ?>" />
                            <input type="hidden" value="<?= $font['url_eot']; ?>" />
                            <span data-row="row-<?= $fontId; ?>" class="omgf-font-remove notice-dismiss">&nbsp;</span>
                        </td>
                    </tr>
                <?php endforeach; ?>
                <tr>
                    <td colspan="5">
                        <span class="description">* <?= __('Only the <strong>woff2</strong> format is preloaded, since this format is widely supported by Modern Browsers which support preload.', 'host-webfonts-local'); ?></span>
                    </td>
                </tr>
                </tbody>
            <?php else: ?>
                <tr>
                    <td>
                        <em><?php _e('No fonts found. Choose <strong>subsets</strong> to start searching for fonts.', 'host-webfonts-local'); ?></em>
                    </td>
                </tr>
            <?php endif; ?>
        </table>
    </div>

    <table id="omgf-control-panel">
        <tbody>
            <tr valign="center">
                <td>
                    <input type="button" id="omgf-download" class="button-primary" value="<?php _e('Download Fonts', 'host-webfonts-local'); ?>" />
                </td>
                <td>
                    <input type="button" id="omgf-generate" class="button-secondary" value="<?php _e('Generate Stylesheet', 'host-webfonts-local'); ?>" />
                </td>
                <td>
                    <a id="omgf-empty" class="button-cancel"><?php _e('Empty Cache Directory', 'host-webfonts-local'); ?></a>
                </td>
                <td style="width: 33%;"></td>
            </tr>
        </tbody>
    </table>
</div>
<div class="omgf-loading" style="display: none;">
    <span class="spinner is-active"> </span>
</div>